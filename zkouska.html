<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Party Mode</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background-color: black;
      transition: background-color 0.05s;
    }
  </style>
</head>
<body>
  <audio id="music" src="song_bost.wav"></audio>

  <script>
    async function start() {
      const audio = document.getElementById("music");
      audio.play();

      // Vytvoření audio contextu a analyseru
      const ctx = new AudioContext();
      const src = ctx.createMediaElementSource(audio);
      const analyser = ctx.createAnalyser();
      src.connect(analyser);
      analyser.connect(ctx.destination);
      analyser.fftSize = 256;

      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);

      function animate() {
        requestAnimationFrame(animate);
        analyser.getByteFrequencyData(dataArray);

        // Vypočítáme průměr hlasitosti
        const avg = dataArray.reduce((a, b) => a + b, 0) / bufferLength;

        // Čím hlasitější část, tím jasnější barva
        const intensity = Math.min(255, Math.max(0, avg * 2));
        document.body.style.backgroundColor = `rgb(${intensity}, 0, ${255 - intensity})`;
      }

      animate();
    }

    // Spuštění po kliknutí (kvůli autoplay politice prohlížečů)
    document.body.addEventListener("click", start);
  </script>
</body>
</html>
